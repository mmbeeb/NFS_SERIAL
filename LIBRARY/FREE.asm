

	;********************************
	;*            FREE              *
	;*   Original ACORN version     *
	;********************************

	;* Assembled using beebasm 1.09 *

	;THIS IS THE MASTER VERSION.

	LOADADDR =?&0E23

	OSASCI=?&FFE3
	OSNEWL=?&FFE7
	OSWRCH=?&FFEE
	OSWORD=?&FFF1
	OSBYTE=?&FFF4

	TXTPTR=?&F2

	CLEAR LOADADDR, LOADADDR+&200
	ORG LOADADDR

.FREE_START
{
IF LOADADDR=&DD00
	LDX #&11
	LDA #&A1
	JSR OSBYTE
	TYA
	BPL L_DD17
	
	LDX #&00
	
.L_DD0C
	LDA D_DD6B,X
	BEQ L_DD17
	
	JSR OSASCI
	INX
	BNE L_DD0C
ENDIF

.L_DD17
	LDA #&00
	STA &AF
	
	JSR S_DE14_PRINT
	EQUS 13, " Disc name      Drive  Bytes free", 13
	
	LDY #&17
	JSR S_DDF4
	
	JSR S_DE14_PRINT
	EQUS "Bytes used", 13
	
.L_DD54
	LDA &AF
	STA OW_BLK+7
	INC &AF
	LDA #&01
	STA OW_BLK+8
	LDA #&0E
	JSR S_DDDE
	LDA OW_BLK+4
	BNE L_DD82
	
	RTS
	
.D_DD6B
	EQUS "Show Free Space. 1.04", 13, 0
	
.L_DD82
	JSR S_DE14_PRINT
	EQUS 13, " "
	
	LDY #&00
	
.L_DD89
	LDA OW_BLK+6,Y
	JSR OSASCI
	INY
	CPY #&10
	BNE L_DD89
	
.L_DD94
	LDA OW_BLK+6,Y
	STA OW_BLK+7,Y
	DEY
	BPL L_DD94
	
	LDA #&0D
	STA OW_BLK+23
	
	JSR S_DE14_PRINT
	EQUS " "
	
	LDA OW_BLK+5
	STA &AF
	INC &AF
	JSR S_DE2E
	
	JSR S_DE14_PRINT
	EQUS " "
	
	LDA OW_BLK+7
	PHA
	LDA OW_BLK+8
	PHA
	
	LDA #&1A
	JSR S_DDDE
	LDA #&00
	STA OW_BLK+3
	JSR S_DE35
	
	PLA
	TAX
	PLA
	CMP OW_BLK+7
	BNE L_DDD9
	
	CPX OW_BLK+8
	BNE L_DDD9
	
	JMP L_DD54
	
.L_DDD9
	LDX #&FD
	JMP L_DDFD

IF LOADADDR=&0E23
	ORG &0F09
	
	EQUD &FFFF0E23
ENDIF

.S_DDDE
	STA OW_BLK+3
	LDA #&28
	STA OW_BLK+1
	LDA #&00
	STA OW_BLK
	
	LDX #LO(OW_BLK)
	LDY #HI(OW_BLK)
	LDA #&14
	JMP OSWORD
	
.S_DDF4
	LDA #&20
	
.L_DDF6
	JSR OSASCI
	DEY
	BNE L_DDF6
	
	RTS
	
.L_DDFD
	LDA OW_BLK+10-&100,X
	SBC OW_BLK+7-&100,X
	STA OW_BLK+7-&100,X
	INX
	BMI L_DDFD
	
	LDY #&14
	JSR S_DDF4
	JSR S_DE35
	JMP L_DD54
	
.S_DE14_PRINT
	PLA
	STA &AD
	PLA
	STA &AE
	
	LDY #&00
	BEQ L_DE21
	
.L_DE1E
	JSR OSASCI
	
.L_DE21
	INC &AD
	BNE L_DE27
	
	INC &AE
	
.L_DE27
	LDA (&AD),Y
	BPL L_DE1E
	
	JMP (&00AD)
	
.S_DE2E
	AND #&0F
	ORA #&30
	JMP OSASCI
	
.S_DE35
	LDX #&09
	LDA #&00
	
.L_DE39
	STA OW_BLK+10,X
	DEX
	BPL L_DE39
	
	LDY #&20
	PHP
	
.L_DE42
	PLP
	ROL OW_BLK+3
	ROL OW_BLK+4
	ROL OW_BLK+5
	ROL OW_BLK+6
	PHP
	DEY
	BMI L_DE72
	
	LDX #&FF
	
.L_DE55
	PHP
	INX
	CPX #&0A
	BEQ L_DE6E
	
	PLP
	LDA OW_BLK+10,X
	ROL A
	STA OW_BLK+10,X
	CMP #&0A
	BCC L_DE55
	
	SBC #&0A
	STA OW_BLK+10,X
	BCS L_DE55
	
.L_DE6E
	PLP
	CLC
	BCC L_DE42
	
.L_DE72
	PLP
	LDX #&09
	LDY #&20
	
.L_DE77
	LDA OW_BLK+10,X
	CMP #&00
	BNE L_DE88
	
	CPY #&20
	BNE L_DE88
	
	TYA
	JSR OSASCI
	
.L_DE86
	BNE L_DE8D
	
.L_DE88
	LDY #&2C
	JSR S_DE2E
	
.L_DE8D
	CPX #&09
	BEQ L_DE99
	
	CPX #&06
	BEQ L_DE99
	
	CPX #&03
	BNE L_DE9D
	
.L_DE99
	TYA
	JSR OSASCI
	
.L_DE9D
	CPX #&01
	BNE L_DEA2
	
	INY
	
.L_DEA2
	DEX
	BPL L_DE77
	
	JSR OSNEWL
	RTS

.OW_BLK
}
.FREE_END

IF HI(FREE_START)=&DD;MASTER
	SAVE "M\$.FREE", FREE_START, FREE_END
ELIF HI(FREE_START)=&0E
	SAVE "E\$.FREE", FREE_START, FREE_END
ELSE
	SAVE "O\$.FREE", FREE_START, FREE_END
ENDIF


